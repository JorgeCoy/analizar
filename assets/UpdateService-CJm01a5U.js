import{l as r}from"./index-BRXbbdqT.js";import"./ui-vendor-DDe9ALYy.js";import"./react-vendor-CcRn9s_c.js";class h{constructor(){this.checkInterval=null,this.lastCheck=null,this.updateAvailable=!1,this.currentVersion="1.0.0"}async initialize(){try{this.currentVersion=localStorage.getItem("appVersion")||this.currentVersion,this.lastCheck=new Date(localStorage.getItem("lastUpdateCheck")||Date.now()),r.log("ðŸ”„ Update Service inicializado - VersiÃ³n:",this.currentVersion)}catch{}}async checkForUpdates(){const e=localStorage.getItem("lastUpdateCheck"),t=Date.now(),i=1440*60*1e3;if(e&&t-parseInt(e)<i||!navigator.onLine)return!1;try{return r.log("âœ… VerificaciÃ³n completada - usando versiÃ³n local"),localStorage.setItem("lastUpdateCheck",t.toString()),!1}catch{return!1}}async checkServiceWorkerUpdates(){try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.ready;if(e.update(),e.waiting)return this.updateAvailable=!0,r.log("ðŸ†• Service Worker update disponible"),!0}return!1}catch{return!1}}compareVersions(e,t){const i=e.split(".").map(Number),s=t.split(".").map(Number);for(let c=0;c<Math.max(i.length,s.length);c++){const l=i[c]||0,u=s[c]||0;if(l>u)return 1;if(l<u)return-1}return 0}async applyUpdate(){if(!this.updateAvailable)return!1;try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.ready;if(e.waiting)return e.waiting.postMessage({type:"SKIP_WAITING"}),e.waiting.addEventListener("statechange",t=>{t.target.state==="activated"&&(r.log("ðŸ”„ ActualizaciÃ³n aplicada, recargando..."),window.location.reload())}),!0}return r.log("ðŸ”„ Aplicando actualizaciÃ³n..."),window.location.reload(),!0}catch{return!1}}startAutoCheck(e=60){this.stopAutoCheck(),this.checkInterval=setInterval(async()=>{try{await this.checkForUpdates()&&this.notifyUserOfUpdate()}catch{}},e*60*1e3)}stopAutoCheck(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}notifyUserOfUpdate(){const e=document.createElement("div");e.className="fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50",e.innerHTML=`
      <div class="flex items-center gap-2">
        <span>ðŸ”„ ActualizaciÃ³n disponible</span>
        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-blue-200 hover:text-white">âœ•</button>
      </div>
      <button onclick="window.location.reload()" class="mt-2 bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded text-sm">
        Actualizar ahora
      </button>
    `,document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},1e4)}getStatus(){return{currentVersion:this.currentVersion,lastCheck:this.lastCheck,updateAvailable:this.updateAvailable,autoCheckActive:this.checkInterval!==null,timeSinceLastCheck:this.lastCheck?Date.now()-this.lastCheck.getTime():null}}}let n=null;const o={getInstance:()=>(n||(n=new h),n),checkForUpdates:()=>{const a=o.getInstance();return a.initialize().then(()=>a.checkForUpdates())},applyUpdate:()=>o.getInstance().applyUpdate(),startAutoCheck:(a=60)=>{const e=o.getInstance();e.initialize().then(()=>{e.startAutoCheck(a)})},stopAutoCheck:()=>{n&&n.stopAutoCheck()},getStatus:()=>o.getInstance().getStatus()};export{o as default,o as updateAPI};
